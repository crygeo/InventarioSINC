<UserControl x:Class="Cliente.View.Dialog.EntitySelectorDialog"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:md="http://materialdesigninxaml.net/winfx/xaml/themes"
             MinWidth="500" MinHeight="400">

    <Grid Margin="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- TÃ­tulo -->
        <TextBlock Grid.Row="0"
                   Text="Seleccionar"
                   Style="{StaticResource MaterialDesignHeadline6TextBlock}"
                   Margin="0,0,0,16"/>

        <!-- Buscador -->
        <Grid Grid.Row="1" Margin="0,0,0,12">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <TextBox Grid.Column="0"
                     md:HintAssist.Hint="Buscar..."
                     Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                     Style="{StaticResource MaterialDesignOutlinedTextBox}">
                <TextBox.InputBindings>
                    <KeyBinding Key="Enter" Command="{Binding SearchCommand}"/>
                </TextBox.InputBindings>
            </TextBox>

            <Button Grid.Column="1"
                    Command="{Binding SearchCommand}"
                    Style="{StaticResource MaterialDesignIconButton}"
                    Margin="8,0,0,0">
                <md:PackIcon Kind="Magnify"/>
            </Button>
        </Grid>

        <!-- Resultados -->
        <Grid Grid.Row="2">
            <!-- Loading -->
            <ProgressBar IsIndeterminate="True"
                         Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}"
                         VerticalAlignment="Top"/>

            <DataGrid ItemsSource="{Binding Results}"
                      SelectedItem="{Binding SelectedItem, Mode=TwoWay}"
                      AutoGenerateColumns="True"
                      IsReadOnly="True"
                      SelectionMode="Single"
                      CanUserAddRows="False"
                      Visibility="{Binding IsLoading,
                                   Converter={StaticResource InverseBooleanToVisibilityConverter}}">
                <DataGrid.InputBindings>
                    <!-- Doble click confirma directamente -->
                    <MouseBinding MouseAction="LeftDoubleClick"
                                  Command="{x:Static md:DialogHost.CloseDialogCommand}"
                                  CommandParameter="{Binding SelectedItem}"/>
                </DataGrid.InputBindings>
            </DataGrid>
        </Grid>

        <!-- Botones -->
        <StackPanel Grid.Row="3"
                    Orientation="Horizontal"
                    HorizontalAlignment="Right"
                    Margin="0,16,0,0">

            <Button Content="CANCELAR"
                    Style="{StaticResource MaterialDesignFlatButton}"
                    Command="{x:Static md:DialogHost.CloseDialogCommand}"
                    CommandParameter="{x:Null}"
                    Margin="0,0,8,0"/>

            <Button Content="ACEPTAR"
                    Style="{StaticResource MaterialDesignRaisedButton}"
                    IsEnabled="{Binding CanConfirm}"
                    Command="{x:Static md:DialogHost.CloseDialogCommand}"
                    CommandParameter="{Binding SelectedItem}"/>
        </StackPanel>
    </Grid>
</UserControl>
